{% extends "base/dashboard_layout.html" %}
{% load static %}

{% block title %}Account Settings - PrintAI Dashboard{% endblock %}

{% block page_title %}Account Settings{% endblock %}

{% block dashboard_content %}
<div class="row">
    <!-- Account Settings -->
    <div class="col-lg-4">
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="card-title mb-0">Profile Information</h5>
            </div>
            <div class="card-body">
                <div class="text-center mb-4">
                    <div class="avatar-wrapper mb-3">
                        {% if profile.avatar %}
                            <img src="{{ profile.avatar.url }}" alt="{{ request.user.username }}" class="rounded-circle" width="100" height="100">
                        {% else %}
                            <div class="avatar-placeholder rounded-circle d-flex align-items-center justify-content-center bg-primary text-white" style="width: 100px; height: 100px; margin: 0 auto;">
                                <span style="font-size: 2.5rem;">{{ request.user.username|slice:":1"|upper }}</span>
                            </div>
                        {% endif %}
                    </div>
                    <h5 class="mb-1">{{ request.user.get_full_name|default:request.user.username }}</h5>
                    <p class="text-muted">{{ request.user.email }}</p>
                    <button class="btn btn-sm btn-outline-primary" data-bs-toggle="modal" data-bs-target="#avatarUploadModal">
                        <i class="fas fa-camera me-1"></i> Change Photo
                    </button>
                </div>
                
                <hr>
                
                <div class="mb-3">
                    <label class="text-muted mb-1">Username</label>
                    <div>{{ request.user.username }}</div>
                </div>
                <div class="mb-3">
                    <label class="text-muted mb-1">Role</label>
                    <div>
                        {% if request.user.is_superuser %}
                            Administrator
                        {% elif request.user.is_staff %}
                            Staff Member
                        {% else %}
                            User
                        {% endif %}
                    </div>
                </div>
                <div class="mb-3">
                    <label class="text-muted mb-1">Account Created</label>
                    <div>{{ request.user.date_joined|date:"F j, Y" }}</div>
                </div>
                <div>
                    <label class="text-muted mb-1">Last Login</label>
                    <div>{{ request.user.last_login|date:"F j, Y" }}</div>
                </div>
            </div>
        </div>
        
        <!-- Account Security -->
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="card-title mb-0">Account Security</h5>
            </div>
            <div class="card-body">
                <div class="d-grid gap-2">
                    <button class="btn btn-outline-primary" data-bs-toggle="modal" data-bs-target="#changePasswordModal">
                        <i class="fas fa-key me-1"></i> Change Password
                    </button>
                    <button class="btn btn-outline-secondary" data-bs-toggle="modal" data-bs-target="#enable2FAModal">
                        <i class="fas fa-shield-alt me-1"></i> Enable Two-Factor Auth
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Personal Information Form -->
    <div class="col-lg-8">
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="card-title mb-0">Personal Information</h5>
            </div>
            <div class="card-body">
                <form method="post" action="">
                    {% csrf_token %}
                    
                    {% if messages %}
                        {% for message in messages %}
                            <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                                {{ message }}
                                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                            </div>
                        {% endfor %}
                    {% endif %}
                    
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="first_name" class="form-label">First Name</label>
                            <input type="text" class="form-control" id="first_name" name="first_name" value="{{ request.user.first_name }}">
                        </div>
                        <div class="col-md-6">
                            <label for="last_name" class="form-label">Last Name</label>
                            <input type="text" class="form-control" id="last_name" name="last_name" value="{{ request.user.last_name }}">
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="email" class="form-label">Email Address</label>
                        <input type="email" class="form-control" id="email" name="email" value="{{ request.user.email }}">
                    </div>
                    
                    <div class="mb-3">
                        <label for="phone" class="form-label">Phone Number</label>
                        <input type="tel" class="form-control" id="phone" name="phone" value="{{ profile.phone_number|default:'' }}">
                    </div>
                    
                    <div class="mb-3">
                        <label for="company" class="form-label">Company/Organization</label>
                        <input type="text" class="form-control" id="company" name="company" value="{{ profile.company|default:'' }}">
                    </div>
                    
                    <div class="mb-3">
                        <label for="position" class="form-label">Position/Title</label>
                        <input type="text" class="form-control" id="position" name="position" value="{{ profile.position|default:'' }}">
                    </div>
                    
                    <div class="mb-3">
                        <label for="bio" class="form-label">Bio</label>
                        <textarea class="form-control" id="bio" name="bio" rows="3">{{ profile.bio|default:'' }}</textarea>
                    </div>
                    
                    <button type="submit" class="btn btn-primary">Save Changes</button>
                </form>
            </div>
        </div>
        
        <!-- Notification Preferences -->
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="card-title mb-0">Notification Preferences</h5>
            </div>
            <div class="card-body">
                <form method="post" action="{% url 'update_notifications' %}">
                    {% csrf_token %}
                    
                    <div class="form-check form-switch mb-3">
                        <input class="form-check-input" type="checkbox" id="emailNotifications" name="email_notifications" {% if profile.email_notifications %}checked{% endif %}>
                        <label class="form-check-label" for="emailNotifications">Email Notifications</label>
                        <div class="text-muted small">Receive important alerts about your printers via email</div>
                    </div>
                    
                    <div class="form-check form-switch mb-3">
                        <input class="form-check-input" type="checkbox" id="printCompletionNotifications" name="print_completion" {% if profile.notify_print_completion %}checked{% endif %}>
                        <label class="form-check-label" for="printCompletionNotifications">Print Completion Notifications</label>
                        <div class="text-muted small">Get notified when your print jobs are complete</div>
                    </div>
                    
                    <div class="form-check form-switch mb-3">
                        <input class="form-check-input" type="checkbox" id="errorNotifications" name="error_notifications" {% if profile.notify_errors %}checked{% endif %}>
                        <label class="form-check-label" for="errorNotifications">Error Notifications</label>
                        <div class="text-muted small">Get notified about printer errors or failures</div>
                    </div>
                    
                    <div class="form-check form-switch mb-3">
                        <input class="form-check-input" type="checkbox" id="systemNotifications" name="system_notifications" {% if profile.notify_system %}checked{% endif %}>
                        <label class="form-check-label" for="systemNotifications">System Notifications</label>
                        <div class="text-muted small">Get notified about system updates and maintenance</div>
                    </div>
                    
                    <button type="submit" class="btn btn-primary">Save Preferences</button>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Password Change Modal -->
<div class="modal fade" id="changePasswordModal" tabindex="-1" aria-labelledby="changePasswordModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="changePasswordModalLabel">Change Password</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form method="post" action="{% url 'change_password' %}">
                    {% csrf_token %}
                    <div class="mb-3">
                        <label for="current_password" class="form-label">Current Password</label>
                        <input type="password" class="form-control" id="current_password" name="current_password" required>
                    </div>
                    <div class="mb-3">
                        <label for="new_password1" class="form-label">New Password</label>
                        <input type="password" class="form-control" id="new_password1" name="new_password1" required>
                    </div>
                    <div class="mb-3">
                        <label for="new_password2" class="form-label">Confirm New Password</label>
                        <input type="password" class="form-control" id="new_password2" name="new_password2" required>
                    </div>
                    <div class="d-grid">
                        <button type="submit" class="btn btn-primary">Update Password</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Avatar Upload Modal -->
<div class="modal fade" id="avatarUploadModal" tabindex="-1" aria-labelledby="avatarUploadModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="avatarUploadModalLabel">Change Profile Photo</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form method="post" action="{% url 'upload_avatar' %}" enctype="multipart/form-data">
                    {% csrf_token %}
                    <div class="mb-3">
                        <label for="avatar" class="form-label">Select Image</label>
                        <input type="file" class="form-control" id="avatar" name="avatar" accept="image/*" required>
                    </div>
                    <div class="d-grid">
                        <button type="submit" class="btn btn-primary">Upload Photo</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- 2FA Modal -->
<div class="modal fade" id="enable2FAModal" tabindex="-1" aria-labelledby="enable2FAModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="enable2FAModalLabel">Two-Factor Authentication</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>Two-factor authentication adds an extra layer of security to your account by requiring more than just a password to sign in.</p>
                
                <div class="text-center py-3">
                    <i class="fas fa-shield-alt fa-3x text-primary mb-3"></i>
                    <p>This feature is coming soon.</p>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}